<script>
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function generate(){
  const prev=document.getElementById('prev').value;
  const type=parseInt(document.getElementById('type').value);

  if(!/^\d{4}$/.test(prev)){
    alert('Result harus 4 digit');
    return;
  }

  const base=prev.split('').map(Number);

  /* ===== RUMUS ===== */
  const rumus=[
    base,
    base.map(v=>(v+1)%10),
    [(base[0]+2)%10,(base[1]+4)%10,(base[2]+5)%10,(base[3]+6)%10],
    [(base[0]+3)%10,(base[1]+5)%10,(base[2]+6)%10,(base[3]+7)%10]
  ];

  /* ===== HASIL 4D (SELANG SELING) ===== */
  let hasil4D=[];
  for(let i=0;i<rumus.length;i++){
    for(let j=i+1;j<rumus.length;j++){
      let val=`${rumus[i][0]}${rumus[j][1]}${rumus[i][2]}${rumus[j][3]}`;
      if(hasil4D.length<50) hasil4D.push(val);
    }
  }

  /* ===== BBFS MAX 6 DIGIT ===== */
  let bbfs=[...new Set(hasil4D.join('').split(''))];
  shuffle(bbfs);
  bbfs=bbfs.slice(0,6);

  /* ===== CB (1 DIGIT → FORMAT 3/7) ===== */
  const cbDigits=[bbfs[0],bbfs[1]].sort();
  const cb=`(${cbDigits.join('/')})`;

  /* ===== HASIL 3D & 2D ===== */
  let hasil=[];
  if(type===4) hasil=hasil4D;
  if(type===3){
    for(let i=0;i<bbfs.length;i++){
      for(let j=i+1;j<bbfs.length;j++){
        for(let k=j+1;k<bbfs.length;k++){
          hasil.push(bbfs[i]+bbfs[j]+bbfs[k]);
        }
      }
    }
  }
  if(type===2){
    for(let i=0;i<bbfs.length;i++){
      for(let j=i+1;j<bbfs.length;j++){
        hasil.push(bbfs[i]+bbfs[j]);
      }
    }
  }

  shuffle(hasil);

  /* ===== OUTPUT ===== */
  document.getElementById('result').innerHTML=`
    <b>RUMUS:</b><br>
    ${rumus.map(r=>r.join('')).join('<br>')}<br><br>

    <b>CB:</b> ${cb}<br>
    <b>BBFS:</b> ${bbfs.join(' ')}<br><br>

    <b>HASIL ${type}D:</b><br>
    ${hasil.slice(0,50).join(' - ')}
  `;

  const h=document.getElementById('history');
  const div=document.createElement('div');
  div.innerText=`[${new Date().toLocaleTimeString()}] ${type}D → ${hasil.slice(0,10).join(' - ')}`;
  h.appendChild(div);
}
</script>
